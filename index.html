<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>darmarket - بيع وكراء</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.0.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.0.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            direction: rtl; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [properties, setProperties] = useState([
                {
                    id: 1,
                    title: "شقة فاخرة في وسط المدينة",
                    price: 350000,
                    rooms: 3,
                    bathrooms: 2,
                    area: 120,
                    city: "الرباط",
                    type: "بيع",
                    image: "https://placehold.co/400x300/4A90E2/FFFFFF?text=شقة+فاخرة",
                    description: "شقة جديدة بحالة ممتازة، تحتوي على 3 غرف نوم وحمامين، مطبخ مجهز، وتراس كبير."
                },
                {
                    id: 2,
                    title: "فيلا حديثة بجوار البحر",
                    price: 850000,
                    rooms: 5,
                    bathrooms: 4,
                    area: 250,
                    city: "الدار البيضاء",
                    type: "بيع",
                    image: "https://placehold.co/400x300/50C878/FFFFFF?text=فيلا+حديثة",
                    description: "فيلا فاخرة بتصميم عصري، تطل على البحر، تحتوي على 5 غرف نوم و4 حمامات، حديقة كبيرة."
                },
                {
                    id: 3,
                    title: "مكتب تجاري في مركز تجاري",
                    price: 150000,
                    rooms: 2,
                    bathrooms: 1,
                    area: 80,
                    city: "casablanca",
                    type: "كراء",
                    image: "https://placehold.co/400x300/FF6B6B/FFFFFF?text=مكتب+تجاري",
                    description: "مكتب تجاري حديث في مركز تجاري، مساحته 80 متر مربع، يقع في موقع استراتيجي."
                },
                {
                    id: 4,
                    title: "بيت ريفي في جبال الأطلس",
                    price: 280000,
                    rooms: 4,
                    bathrooms: 2,
                    area: 180,
                    city: "مراكش",
                    type: "بيع",
                    image: "https://placehold.co/400x300/8B4513/FFFFFF?text=بيت+ريفية",
                    description: "بيت ريفي جميل في جبال الأطلس، يحتوي على 4 غرف نوم، حديقة واسعة، ووجهة نظرة رائعة."
                }
            ]);

            const [searchParams, setSearchParams] = useState({
                city: '',
                minPrice: '',
                maxPrice: '',
                type: ''
            });

            const [newProperty, setNewProperty] = useState({
                title: '',
                price: '',
                rooms: '',
                bathrooms: '',
                area: '',
                city: '',
                type: 'بيع',
                description: '',
                image: ''
            });

            const filteredProperties = properties.filter(property => {
                if (searchParams.city && property.city !== searchParams.city) return false;
                if (searchParams.minPrice && property.price < parseInt(searchParams.minPrice)) return false;
                if (searchParams.maxPrice && property.price > parseInt(searchParams.maxPrice)) return false;
                if (searchParams.type && property.type !== searchParams.type) return false;
                return true;
            });

            // **التعديل 1: إضافة (e) ومنع الإرسال التلقائي**
            const handleAddProperty = (e) => {
                e.preventDefault(); // هذا يوقف إعادة رسم الصفحة وإغلاق لوحة المفاتيح

                const property = {
                    id: properties.length + 1,
                    ...newProperty,
                    image: newProperty.image || `https://placehold.co/400x300/4A90E2/FFFFFF?text=${newProperty.title}`
                };
                setProperties([...properties, property]);
                setNewProperty({
                    title: '',
                    price: '',
                    rooms: '',
                    bathrooms: '',
                    area: '',
                    city: '',
                    type: 'بيع',
                    description: '',
                    image: ''
                });
                setCurrentPage('properties');
            };

            const Navigation = () => (
                <nav className="bg-blue-600 text-white p-4 shadow-lg">
                    <div className="container mx-auto flex justify-between items-center">
                        <h1 className="text-xl font-bold">darmarket</h1>
                        <div className="flex space-x-4">
                            <button 
                                onClick={() => setCurrentPage('home')}
                                className={`px-3 py-1 rounded ${currentPage === 'home' ? 'bg-blue-800' : 'hover:bg-blue-700'}`}
                            >
                                الرئيسية
                            </button>
                            <button 
                                onClick={() => setCurrentPage('properties')}
                                className={`px-3 py-1 rounded ${currentPage === 'properties' ? 'bg-blue-800' : 'hover:bg-blue-700'}`}
                            >
                                العقارات
                            </button>
                            <button 
                                onClick={() => setCurrentPage('search')}
                                className={`px-3 py-1 rounded ${currentPage === 'search' ? 'bg-blue-800' : 'hover:bg-blue-700'}`}
                            >
                                البحث
                            </button>
                            <button 
                                onClick={() => setCurrentPage('add')}
                                className={`px-3 py-1 rounded ${currentPage === 'add' ? 'bg-blue-800' : 'hover:bg-blue-700'}`}
                            >
                                إضافة عقار
                            </button>
                        </div>
                    </div>
                </nav>
            );

            const AdvertisementBanner = () => (
                <div className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-lg p-4 mb-6 text-center">
                    <div className="flex items-center justify-center">
                        <i className="fas fa-ad text-2xl mr-3"></i>
                        <div>
                            <h3 className="font-bold text-lg">إعلان مميز</h3>
                            <p className="text-sm">احصل على خصم 20% على عمولة البيع</p>
                        </div>
                    </div>
                </div>
            );

            const SidebarAd = () => (
                <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg p-4 text-center">
                        <h4 className="font-bold mb-2">إعلان جانبي</h4>
                        <p className="text-sm">خدمات عقارية متكاملة</p>
                        <button className="mt-2 bg-white text-purple-600 px-4 py-1 rounded text-sm font-semibold">
                            تعرف أكثر
                        </button>
                    </div>
                </div>
            );

            const HomePage = () => (
                <div className="container mx-auto p-4">
                    <AdvertisementBanner />
                    
                    <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-8 mb-6 text-center">
                        <h2 className="text-3xl font-bold mb-4">ابحث عن عقارك المثالي</h2>
                        <p className="text-lg mb-6">اكتشف أفضل العروض في سوق العقارات المغربي</p>
                        <button 
                            onClick={() => setCurrentPage('search')}
                            className="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100"
                        >
                            ابدأ البحث
                        </button>
                    </div>

                    <div className="grid md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-4xl text-blue-600 mb-3">
                                <i className="fas fa-home"></i>
                            </div>
                            <h3 className="text-xl font-semibold mb-2">العقارات المعروضة</h3>
                            <p className="text-gray-600">{properties.length} عقار</p>
                        </div>
                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-4xl text-green-600 mb-3">
                                <i className="fas fa-map-marker-alt"></i>
                            </div>
                            <h3 className="text-xl font-semibold mb-2">المدن المتاحة</h3>
                            <p className="text-gray-600">5+ مدن</p>
                        </div>
                        <div className="bg-white rounded-lg shadow-md p-6 text-center">
                            <div className="text-4xl text-purple-600 mb-3">
                                <i className="fas fa-chart-line"></i>
                            </div>
                            <h3 className="text-xl font-semibold mb-2">أسعار مناسبة</h3>
                            <p className="text-gray-600">أسعار تنافسية</p>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-md p-6">
                        <h3 className="text-xl font-semibold mb-4">أحدث الإضافات</h3>
                        <div className="grid md:grid-cols-2 gap-4">
                            {properties.slice(0, 2).map(property => (
                                <div key={property.id} className="border rounded-lg p-4">
                                    <img src={property.image} alt={property.title} className="w-full h-40 object-cover rounded-lg mb-3" />
                                    <h4 className="font-semibold">{property.title}</h4>
                                    <p className="text-blue-600 font-bold text-lg">{property.price.toLocaleString()} درهم</p>
                                    <p className="text-gray-600 text-sm">{property.city}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const PropertiesPage = () => (
                <div className="container mx-auto p-4">
                    <AdvertisementBanner />
                    <h2 className="text-2xl font-bold mb-6">جميع العقارات</h2>
                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredProperties.map(property => (
                            <div key={property.id} className="bg-white rounded-lg shadow-md overflow-hidden">
                                <img src={property.image} alt={property.title} className="w-full h-48 object-cover" />
                                <div className="p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <h3 className="font-semibold text-lg">{property.title}</h3>
                                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                            property.type === 'بيع' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                                        }`}>
                                            {property.type}
                                        </span>
                                    </div>
                                    <p className="text-blue-600 font-bold text-xl mb-2">{property.price.toLocaleString()} درهم</p>
                                    <div className="flex flex-wrap gap-2 text-sm text-gray-600 mb-3">
                                        <span><i className="fas fa-bed mr-1"></i>{property.rooms} غرف</span>
                                        <span><i className="fas fa-bath mr-1"></i>{property.bathrooms} حمام</span>
                                        <span><i className="fas fa-expand mr-1"></i>{property.area} م²</span>
                                    </div>
                                    <p className="text-gray-600 mb-3">{property.description}</p>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-500"><i className="fas fa-map-marker-alt mr-1"></i>{property.city}</span>
                                        <button className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                            عرض التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const SearchPage = () => (
                <div className="container mx-auto p-4">
                    <AdvertisementBanner />
                    <h2 className="text-2xl font-bold mb-6">بحث العقارات</h2>
                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div className="grid md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">المدينة</label>
                                <select 
                                    value={searchParams.city}
                                    onChange={(e) => setSearchParams({...searchParams, city: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="">اختر المدينة</option>
                                    <option value="الرباط">الرباط</option>
                                    <option value="الدار البيضاء">الدار البيضاء</option>
                                    <option value="casablanca">casablanca</option>
                                    <option value="مراكش">مراكش</option>
                                    <option value="فاس">فاس</option>
                                    <option value="مكناس">مكناس</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">النوع</label>
                                <select 
                                    value={searchParams.type}
                                    onChange={(e) => setSearchParams({...searchParams, type: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="">الكل</option>
                                    <option value="بيع">بيع</option>
                                    <option value="كراء">كراء</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">السعر الأدنى</label>
                                <input 
                                    type="number"
                                    value={searchParams.minPrice}
                                    onChange={(e) => setSearchParams({...searchParams, minPrice: e.target.value})}
                                    placeholder="السعر الأدنى"
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">السعر الأقصى</label>
                                <input 
                                    type="number"
                                    value={searchParams.maxPrice}
                                    onChange={(e) => setSearchParams({...searchParams, maxPrice: e.target.value})}
                                    placeholder="السعر الأقصى"
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                        </div>
                        <button 
                            onClick={() => setCurrentPage('properties')}
                            className="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700"
                        >
                            بحث
                        </button>
                    </div>

                    {filteredProperties.length > 0 && (
                        <PropertiesPage />
                    )}
                </div>
            );

            const AddPropertyPage = () => (
                <div className="container mx-auto p-4">
                    <AdvertisementBanner />
                    <h2 className="text-2xl font-bold mb-6">إضافة عقار جديد</h2>
                    {/* **التعديل 2: تغيير <div> إلى <form> وربطها بالدالة** */}
                    <form className="bg-white rounded-lg shadow-md p-6" onSubmit={handleAddProperty}>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">العنوان</label>
                                <input 
                                    type="text"
                                    value={newProperty.title}
                                    onChange={(e) => setNewProperty({...newProperty, title: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="اسم العقار"
                                 />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">السعر</label>
                                <input 
                                    type="number"
                                    value={newProperty.price}
                                    onChange={(e) => setNewProperty({...newProperty, price: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="السعر بالدرهم"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">عدد الغرف</label>
                                <input 
                                    type="number"
                                    value={newProperty.rooms}
                                    onChange={(e) => setNewProperty({...newProperty, rooms: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="عدد الغرف"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">عدد الحمامات</label>
                                <input 
                                    type="number"
                                    value={newProperty.bathrooms}
                                    onChange={(e) => setNewProperty({...newProperty, bathrooms: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="عدد الحمامات"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">المساحة (م²)</label>
                                <input 
                                    type="number"
                                    value={newProperty.area}
                                    onChange={(e) => setNewProperty({...newProperty, area: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="المساحة"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">المدينة</label>
                                <input 
                                    type="text"
                                    value={newProperty.city}
                                    onChange={(e) => setNewProperty({...newProperty, city: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="المدينة"
                                />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-semibold mb-2">النوع</label>
                                <select 
                                    value={newProperty.type}
                                    onChange={(e) => setNewProperty({...newProperty, type: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="بيع">بيع</option>
                                    <option value="كراء">كراء</option>
                                </select>
                            </div>
                            <div className="md:col-span-2">
                                <label className="block text-gray-700 font-semibold mb-2">الوصف</label>
                                <textarea 
                                    value={newProperty.description}
                                    onChange={(e) => setNewProperty({...newProperty, description: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="4"
                                    placeholder="وصف العقار..."
                                ></textarea>
                            </div>
                            <div className="md:col-span-2">
                                {/* **تم تغيير Label ليعكس أنك ستختار ملفاً** */}
                                <label className="block text-gray-700 font-semibold mb-2">صورة العقار (اختيار ملف)</label>
                                <input 
                                    type="file" 
                                    value={newProperty.image}
                                    onChange={(e) => setNewProperty({...newProperty, image: e.target.value})}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="اختيار ملف الصورة"
                                />
                            </div>
                        </div>
                        <div className="mt-6 flex space-x-4">
                            {/* **التعديل 3: تحويل الزر إلى type="submit"** */}
                            <button 
                                type="submit"
                                // تم حذف onClick لربطه بالـ form
                                className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700"
                            >
                                إضافة العقار
                            </button>
                            <button 
                                onClick={() => setCurrentPage('home')}
                                className="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600"
                            >
                                إلغاء
                            </button>
                        </div>
                    </form> {/* **التعديل 4: إغلاق وسم <form>** */}
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-100">
                    <Navigation />
                    <main className="py-6">
                        <div className="container mx-auto">
                            <div className="flex flex-col md:flex-row gap-6">
                                <div className="md:w-3/4">
                                    {currentPage === 'home' && <HomePage />}
                                    {currentPage === 'properties' && <PropertiesPage />}
                                    {currentPage === 'search' && <SearchPage />}
                                    {currentPage === 'add' && <AddPropertyPage />}
                                </div>
                                <div className="md:w-1/4">
                                    <SidebarAd />
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer className="bg-gray-800 text-white p-6 mt-8">
                        <div className="container mx-auto text-center">
                            <p>&copy; 2023 darmarket. جميع الحقوق محفوظة.</p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
