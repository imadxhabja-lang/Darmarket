<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- ... ÙƒÙ„ ÙƒÙˆØ¯ Ø§Ù„head ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ... -->
</head>
<body>
    <!-- ... ÙƒÙ„ ÙƒÙˆØ¯ Ø§Ù„body ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ... -->
    
    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª - ØªØ¨Ø¯Ø£ ÙØ§Ø±ØºØ© ÙˆØªÙØ­Ù…Ù‘Ù„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
        let properties = [];
        let currentImage = null;
        
        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ==========
        const STORAGE_KEY = 'darmarket2_properties_v2';
        
        function saveProperties() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(properties));
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸', properties.length, 'Ø¹Ù‚Ø§Ø±Ø§Øª');
            } catch (e) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', e);
            }
        }
        
        function loadProperties() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
                    properties = parsed.filter(p => p && p.title && p.price);
                    console.log('ğŸ“‚ ØªÙ… ØªØ­Ù…ÙŠÙ„', properties.length, 'Ø¹Ù‚Ø§Ø±Ø§Øª');
                    
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¹Ù‚Ø§Ø±Ø§ØªØŒ Ø£Ø¶Ù Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    if (properties.length === 0) {
                        properties = [
                            {
                                id: 1,
                                title: "ÙÙŠÙ„Ø§ ÙØ§Ø®Ø±Ø© ÙÙŠ Ù…Ø±Ø§ÙƒØ´",
                                description: "5 ØºØ±Ù Ù†ÙˆÙ…ØŒ Ù…Ø³Ø¨Ø­ØŒ Ø­Ø¯ÙŠÙ‚Ø© Ø®Ø§ØµØ©",
                                price: 4200000,
                                location: "Ù…Ø±Ø§ÙƒØ´",
                                type: "Ø¨ÙŠØ¹",
                                date: new Date().toLocaleDateString('ar-MA'),
                                image: null
                            },
                            {
                                id: 2,
                                title: "Ø´Ù‚Ø© Ø­Ø¯ÙŠØ«Ø© ÙÙŠ Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡",
                                description: "3 ØºØ±Ù Ù†ÙˆÙ…ØŒ ØµØ§Ù„Ø©ØŒ Ù…Ø·Ø¨Ø® Ù…ÙØªÙˆØ­",
                                price: 12500,
                                location: "Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡",
                                type: "Ø¥ÙŠØ¬Ø§Ø±",
                                date: new Date().toLocaleDateString('ar-MA'),
                                image: null
                            }
                        ];
                        saveProperties();
                    }
                } else {
                    // Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ÙØ¸ Ø³Ø§Ø¨Ù‚ØŒ Ø£Ø¶Ù Ø§Ù„Ø£Ù…Ø«Ù„Ø©
                    properties = [
                        {
                            id: 1,
                            title: "ÙÙŠÙ„Ø§ ÙØ§Ø®Ø±Ø© ÙÙŠ Ù…Ø±Ø§ÙƒØ´",
                            description: "5 ØºØ±Ù Ù†ÙˆÙ…ØŒ Ù…Ø³Ø¨Ø­ØŒ Ø­Ø¯ÙŠÙ‚Ø© Ø®Ø§ØµØ©",
                            price: 4200000,
                            location: "Ù…Ø±Ø§ÙƒØ´",
                            type: "Ø¨ÙŠØ¹",
                            date: new Date().toLocaleDateString('ar-MA'),
                            image: null
                        },
                        {
                            id: 2,
                            title: "Ø´Ù‚Ø© Ø­Ø¯ÙŠØ«Ø© ÙÙŠ Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡",
                            description: "3 ØºØ±Ù Ù†ÙˆÙ…ØŒ ØµØ§Ù„Ø©ØŒ Ù…Ø·Ø¨Ø® Ù…ÙØªÙˆØ­",
                            price: 12500,
                            location: "Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡",
                            type: "Ø¥ÙŠØ¬Ø§Ø±",
                            date: new Date().toLocaleDateString('ar-MA'),
                            image: null
                        }
                    ];
                    saveProperties();
                }
            } catch (e) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', e);
                properties = [];
            }
        }
        // ========== Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† ==========
        
        // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
        document.getElementById('propertyImages').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentImage = event.target.result;
                    console.log('ğŸ“¸ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
        function displayProperties() {
            const container = document.getElementById('listingsContainer');
            
            if (properties.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 4rem;">ğŸ </div>
                        <h3 style="margin: 1rem 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¶ÙŠÙ Ø¹Ù‚Ø§Ø±Ø§Ù‹!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = properties.map(property => `
                <div class="property-card" data-id="${property.id}">
                    <div class="property-image">
                        ${property.image ? 
                            `<img src="${property.image}" alt="${property.title}" style="width:100%; height:100%; object-fit:cover; border-radius: 8px 8px 0 0;">` : 
                            `<span style="font-size: 3rem;">${property.type === 'Ø¨ÙŠØ¹' ? 'ğŸ ' : 'ğŸ¢'}</span>`
                        }
                    </div>
                    <div class="property-details">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <h3 style="margin: 0;">${property.title}</h3>
                            <button onclick="deleteProperty(${property.id})" class="delete-btn">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                        <p style="color: #555; margin-bottom: 10px;">${property.description}</p>
                        <div class="property-price">
                            ${property.type === 'Ø¥ÙŠØ¬Ø§Ø±' ? property.price.toLocaleString() + ' Ø¯.Ù…./Ø´Ù‡Ø±ÙŠØ§Ù‹' : property.price.toLocaleString() + ' Ø¯.Ù….'}
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: #1abc9c; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9rem;">
                                ${property.type}
                            </span>
                            <span style="color: #666;">ğŸ“ ${property.location}</span>
                            <span style="color: #666;">ğŸ“… ${property.date}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Ø­ÙØ¸ Ø¨Ø¹Ø¯ ÙƒÙ„ ØªØ­Ø¯ÙŠØ«
            saveProperties();
        }
        
        // Ø­Ø°Ù Ø¹Ù‚Ø§Ø±
        function deleteProperty(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ')) {
                properties = properties.filter(property => property.id !== id);
                displayProperties();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±');
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯
        document.getElementById('addPropertyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const title = document.getElementById('propertyTitle').value.trim();
            const type = document.getElementById('propertyDealType').value;
            const location = document.getElementById('propertyLocation').value.trim();
            const price = document.getElementById('propertyPrice').value;
            const description = document.getElementById('propertyDescription').value.trim();
            
            if (!title || !type || !location || !price || !description) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const newProperty = {
                id: Date.now(),
                title: title,
                type: type,
                location: location,
                price: parseInt(price),
                description: description,
                date: new Date().toLocaleDateString('ar-MA'),
                image: currentImage
            };
            
            properties.unshift(newProperty);
            displayProperties();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            this.reset();
            currentImage = null;
            document.getElementById('propertyImages').value = '';
            
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø°Ø§ Ø³Ù…Ø­
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('ğŸ  Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯!', {
                    body: `ØªÙ… Ø¥Ø¶Ø§ÙØ© "${newProperty.title}"`,
                    icon: 'https://i.ibb.co/SwVN7NNf/logo.png'
                });
            }
        });
        
        // Ø§Ù„Ø¨Ø­Ø«
        document.getElementById('propertySearchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const dealType = document.getElementById('dealType').value;
            const location = document.getElementById('location').value;
            
            if (dealType || location) {
                alert(`ğŸ” Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†:\n${dealType ? 'Ø§Ù„Ù†ÙˆØ¹: ' + dealType + '\n' : ''}${location ? 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ' + location : ''}`);
            } else {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨Ø­Ø«');
            }
        });
        
        // ØªÙ‡ÙŠØ¦Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹...');
            loadProperties();
            displayProperties();
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/Darmarket/sw.js')
                    .then(() => console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„'))
                    .catch(err => console.log('âŒ Ø®Ø·Ø£:', err));
            }
            
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission();
                }, 3000);
            }
            
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„', properties.length, 'Ø¹Ù‚Ø§Ø±Ø§Øª');
        });
    </script>
</body>
</html>
